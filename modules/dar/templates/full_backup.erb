#!/bin/bash

# shipped by Puppet, do not modify

BACKUP_DIR=/<%= @backup_dir %>
BACKUP_REMOTE=<%= @backup_remote %>
BACKUP_NAME=${BACKUP_DIR}/$(hostname -f)

echo
echo "** Starting up backup [ $(date -R) ]"
echo "** Full backup using dar ..."
dar -c "${BACKUP_NAME}_full" -R / $@

echo "** Copying backup to Google Cloud Storage ..."
remote_name="${BACKUP_NAME}_full.1.dar"
gsutil -q cp "$remote_name" "$BACKUP_REMOTE"

echo "** All done. [ $(date -R) ]"
